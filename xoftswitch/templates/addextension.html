{{define "title"}}Add Extension{{end}}
{{define "content"}}
<h1>Add Extension</h1>

<form id="add-ext-form" method="POST" class="form-standard" novalidate>
  <div class="form-row">
    <label for="extstart">Ext Start:</label>
    <input id="extstart" name="extstart" required placeholder="Enter starting extension number" inputmode="numeric" pattern="[0-9]+">
  </div>

  <div class="form-row">
    <label for="extend">Ext End:</label>
    <input id="extend" name="extend" placeholder="Optional ending extension number" inputmode="numeric" pattern="[0-9]+">
  </div>

  <div class="form-row">
    <label for="displayname">Display Name:</label>
    <input id="displayname" name="displayname" value="XO {ext}" placeholder="Optional display name">
  </div>

  <div class="form-row">
    <label for="email">Email:</label>
    <input id="email" name="email" value="{ext}@xoftphone.com" placeholder="Optional email">
  </div>
  <div class="form-row">
    <label for="displayname">Secret:</label>
    <input id="secret" name="secret" value="" placeholder="Optional, auto generate">
  </div>

  

  <div class="form-row">
    <label for="webrtc">WebRTC:</label>
    <select id="webrtc" name="webrtc">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-row">
    <label for="direct_media">Direct Media:</label>
    <select id="direct_media" name="direct_media">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>
  
  
 
  

  <div class="form-row">
    <label for="public">Public:</label>
    <select id="public" name="public">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-row">
    <label for="canblock">Can Block:</label>
    <select id="canblock" name="canblock">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-row">
    <label for="canunlist">Can Unlist:</label>
    <select id="canunlist" name="canunlist">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-row">
    <label for="canaddlist">Can Add List:</label>
    <select id="canaddlist" name="canaddlist">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-row">
    <label for="candial">Can Dialout:</label>
    <select id="candial" name="candial">
      <option value="yes" selected>Yes</option>
      <option value="no">No</option>
    </select>
  </div>

  <div class="form-actions">
    <button id="submit-btn" type="submit" class="btn-submit">Add Extension</button>
    <a href="/extensions" class="btn-cancel">Cancel</a>
  </div>
</form>

<!-- Loading overlay -->
<div id="loading-overlay" aria-hidden="true">
  <div class="loader" role="status" aria-live="polite" aria-label="Submitting, please wait"></div>
  <div class="loader-text">Submitting… Please wait</div>
</div>

<style>
/* Layout */
body { font-family: Arial, sans-serif; background-color: #f7f7f7; padding: 20px; }
h1 { color: #333; margin-bottom: 20px; }
.form-standard { background: #fff; padding: 20px; border-radius: 8px; max-width: 500px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.form-row { display: flex; flex-direction: column; margin-bottom: 15px; }
.form-row label { font-weight: bold; margin-bottom: 5px; color: #555; }
.form-row input, .form-row select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
.form-row input:focus, .form-row select:focus { outline: none; border-color: #007BFF; box-shadow: 0 0 3px rgba(0,123,255,0.3); }
.form-actions { display: flex; gap: 10px; justify-content: flex-start; margin-top: 20px; }
.btn-submit { background-color: #007BFF; color: white; border: none; padding: 10px 18px; border-radius: 4px; cursor: pointer; font-size: 14px; }
.btn-submit:hover { background-color: #0056b3; }
.btn-cancel { display: inline-block; padding: 10px 18px; color: #555; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; font-size: 14px; }
.btn-cancel:hover { background-color: #eee; color: #333; }
@media (max-width: 600px) { .form-standard { padding: 15px; } .form-actions { flex-direction: column; } .btn-submit, .btn-cancel { width: 100%; } }

/* Loading overlay */
#loading-overlay {
  position: fixed;
  inset: 0;
  background: rgba(255,255,255,0.85);
  display: none; /* shown on submit */
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 9999;
}
#loading-overlay.active { display: flex; }
.loader {
  width: 48px; height: 48px;
  border: 4px solid #ddd;
  border-top-color: #007BFF;
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
  margin-bottom: 12px;
}
.loader-text { color: #333; font-size: 14px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Disabled button state */
.btn-submit[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>

<script>
(function() {
  const form = document.getElementById('add-ext-form');
  const overlay = document.getElementById('loading-overlay');
  const submitBtn = document.getElementById('submit-btn');
  let submitting = false;

  form.addEventListener('submit', function(e) {
    if (submitting) {
      // Prevent double-submits
      e.preventDefault();
      return false;
    }
    // Optional: basic client-side numeric check for extstart/extend
    const start = document.getElementById('extstart').value.trim();
    const end = document.getElementById('extend').value.trim();
    if (start && end && Number(end) < Number(start)) {
      e.preventDefault();
      alert('Ext End must be greater than or equal to Ext Start.');
      return false;
    }

    submitting = true;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting…';
    overlay.classList.add('active');

    // Let the normal POST proceed; overlay stays until server responds
    // No need to preventDefault() unless you’re doing AJAX.
  });

  // If the page uses Turbolinks/HTMX/etc., you might also want to
  // hide the overlay on navigation error events. For plain form POST,
  // the browser will replace the page on response.
})();
</script>
{{end}}
